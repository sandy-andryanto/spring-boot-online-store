<main class="flex-shrink-0 p-3 border-bottom bg-gray text-uppercase mb-5" id="breadcrumb">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mt-2">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item"><a href="#">Order</a></li>
                        <li class="breadcrumb-item active" aria-current="page">My Cart</li>
                    </ol>
                </nav>
            </div>
        </div>
    </div>
</main>
<main class="flex-shrink-0 mb-3">
    <div class="container">
        <div *ngIf="errorMessage" class="alert alert-danger">
          {{ errorMessage }}
        </div>
        <div class="row">
            <div class="col-md-6">
              <ng-container *ngIf="loadingCart; else loadingCartRef">
                  <ngx-skeleton-loader appearance="square"  [theme]="{ width: '100%', height: '680px' }"></ngx-skeleton-loader>
              </ng-container>
              <ng-template #loadingCartRef>
                   <div class="slider-container">
                    <ngx-slick-carousel class="carousel" #slickModal="slick-carousel" [config]="slideConfig">
                      <div ngxSlickItem class="slide border-0 card me-2" *ngFor="let slide of images; index as i;">
                        <img [src]="slide.path" alt="" width="100%">
                      </div>
                    </ngx-slick-carousel>
                  </div>
              </ng-template>
            </div>
            <div class="col-md-6">
                <ng-container *ngIf="loadingCart; else loadingCartRef2">
                    <ngx-skeleton-loader appearance="square"  [theme]="{ width: '100%', height: '100px' }"></ngx-skeleton-loader>
                    <ngx-skeleton-loader appearance="square"  [theme]="{ width: '100%', height: '200px' }"></ngx-skeleton-loader>
                    <ngx-skeleton-loader appearance="square"  [theme]="{ width: '100%', height: '200px' }"></ngx-skeleton-loader>
                    <ngx-skeleton-loader appearance="square"  [theme]="{ width: '100%', height: '132px' }"></ngx-skeleton-loader>
                </ng-container>
                <ng-template #loadingCartRef2>
                    <div class="p-3">
                        <h3 class="fw-bolder text-uppercase">{{ product.name }}</h3>
                        <div class='clearfix mt-3 mb-1'>
                            <div class="small text-warning mb-2">
                                <i class="bi bi-star-fill" *ngFor="let i of [].constructor(product.totalRating)"></i>
                                <i class="bi bi-star" *ngFor="let j of [].constructor(5 - product.totalRating)"></i>
                            </div>
                            <a href='#' class='text-decoration-none'><small>{{ reviews.length }} Review(s) | Add your review</small></a>
                        </div>
                        <strong class='text-danger me-2'>${{ price }}</strong><del><strong class='text-muted'>${{ product.priceOld }}</strong></del><strong class='text-danger ms-2'>IN STOCK</strong>
                        <p class='mt-2'>
                          {{ product.description }}
                        </p>
                        <div class='clearfix mt-2'>
                            <button  class="btn btn-light border me-1" (click)="handleWhislist($event)">
                                <i class="bi bi-heart me-1"></i>
                            </button>
                            <button  class="btn btn-light border me-1">
                                <i class="bi bi-currency-exchange me-1"></i>
                            </button>
                            <button  class="btn btn-light border me-1">
                                <i class="bi bi-eye me-1"></i>
                            </button>
                        </div>
                        <div class='mt-4 text-uppercase'>
                            <span class='text-muted d-inline'>Category :</span>
                            <a class='d-inline ms-1 text-decoration-none' href="#" *ngFor="let category of categories;">{{ category }} </a>
                        </div>
                        <div class='text-uppercase mt-2'>
                            <small class='text-muted d-inline'>Share :</small>
                            <a class='d-inline ms-1 text-decoration-none' target="_blank" href="https://www.facebook.com/"><i class="bi bi-facebook ms-1"></i></a>
                            <a class='d-inline ms-1 text-decoration-none' target="_blank" href="https://www.twitter.com/"><i class="bi bi-twitter ms-1"></i></a>
                            <a class='d-inline ms-1 text-decoration-none' target="_blank" href="https://www.google.com/"><i class="bi bi-google ms-1"></i></a>
                            <a class='d-inline ms-1 text-decoration-none' target="_blank" href="https://www.instagram.com/"><i class="bi bi-instagram ms-1"></i></a>
                        </div>
                        <div class='text-uppercase mt-2' *ngIf="maxStock > 0">
                          <span className='text-muted d-inline fw-bold text-success'>available : {{maxStock }} pcs</span>
                        </div>
                        <form class="mt-3">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Size <span class="text-danger">*</span></label>
                                        <select class="form-control" [(ngModel)]="sizeId" name="category" (change)="handleSize($event)">
                                            <option value="0" selected disabled>Please Select Size</option>
                                            <option *ngFor="let s of sizes" [value]="s.id">{{ s.name }}</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Colour <span class="text-danger">*</span></label>
                                        <select class="form-control" [(ngModel)]="colourId" name="colour" (change)="handleColour($event)">
                                            <option value="0" selected disabled>Please Select Colour</option>
                                            <option *ngFor="let c of colours" [value]="c.id">{{ c.name }}</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Qty <span class="text-danger">*</span></label>
                                        <div class="input-group">
                                            <button class="btn btn-danger" type="button" (click)="setQty($event, '-')">
                                                <i class="bi bi-bag-dash"></i>
                                            </button>
                                            <input readonly type="number" class="form-control text-center" [value]="qty">
                                            <button class="btn btn-success" type="button" (click)="setQty($event, '+')">
                                                <i class="bi bi-bag-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label fw-bold text-danger">$ Total </label>
                                        <input readonly type="text" [value]="total" class="form-control text-end">
                                    </div>
                                </div>
                            </div>
                            <a  (click)="handleAddCart($event)" [ngClass]="(total > 0 && sizeId > 0 && colourId > 0) ? 'btn btn-primary text-white w-100 mt-4' : 'disabled btn btn-primary text-white w-100 mt-4'" href="#"><i class="bi bi-cart-plus mb-1 me-1"></i>Add To Cart</a>
                        </form>
                    </div>
                 </ng-template>
            </div>
        </div>
    </div>
</main>
<main class="flex-shrink-0 mt-5 mb-3">
    <div class="container">
        <div class="row mb-2">
            <div class="col-md-12">
                <ul class="nav nav-underline">
                    <li class="nav-item">
                        <a href="#" class="nav-link" (click)="handleTab($event, 0)" [class]="tabActive === 0 ? 'active' : ''"  aria-current="page">Description</a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" (click)="handleTab($event, 1)" [class]="tabActive === 1 ? 'active' : ''" aria-current="page">Details</a>
                    </li>
                    <li class="nav-item active">
                        <a href="#" class="nav-link" (click)="handleTab($event, 2)" [class]="tabActive === 2 ? 'active' : ''" aria-current="page">Reviews ({{ reviews.length }})</a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane container" [class]="tabActive === 0 ? 'active p-0' : ''">
                        <ng-container *ngIf="loadingCart; else loadingCartRef3">
                          <div class="p-0 mt-2">
                            <ngx-skeleton-loader appearance="square"  [theme]="{ width: '100%', height: '280px' }"></ngx-skeleton-loader>
                          </div>
                        </ng-container>
                        <ng-template #loadingCartRef3>
                            <p class='mt-3'>
                               {{ product.description }}
                            </p>
                        </ng-template>
                    </div>
                    <div class="tab-pane container" [class]="tabActive === 1 ? 'active p-0' : ''">
                        <ng-container *ngIf="loadingCart; else loadingCartRef4">
                           <div class="p-0 mt-2">
                            <ngx-skeleton-loader appearance="square"  [theme]="{ width: '100%', height: '280px' }"></ngx-skeleton-loader>
                          </div>
                        </ng-container>
                        <ng-template #loadingCartRef4>
                            <p class='mt-3'>
                                {{ product.details }}
                            </p>
                        </ng-template>
                    </div>
                    <div class="tab-pane container" [class]="tabActive === 2 ? 'active p-0' : ''">
                        <div class="row mt-3">
                            <div class="col-md-3">
                                <ng-container *ngIf="loadingReview; else loadingReview1">
                                    <ngx-skeleton-loader appearance="square"  [theme]="{ width: '100%', height: '280px' }"></ngx-skeleton-loader>
                                </ng-container>
                                <ng-template #loadingReview1>
                                  <div class="clearfix">
                                    <h4 class='d-inline me-3'>{{ product.totalRating }}</h4>
                                    <div class="d-inline text-warning">
                                        <i class="bi bi-star-fill" *ngFor="let i of [].constructor(product.totalRating)"></i>
                                        <i class="bi bi-star" *ngFor="let j of [].constructor(5 - product.totalRating)"></i>
                                    </div>
                                  </div>
                                  <div class="clearfix mt-2">
                                      <div class="row" *ngFor="let review of reviews">
                                          <div class="col-md-6">
                                              <div class="d-inline text-warning">
                                                  <i class="bi bi-star-fill" *ngFor="let vv of [].constructor(review.rating)"></i>
                                                  <i class="bi bi-star" *ngFor="let fg of [].constructor(5 - review.rating)"></i>
                                              </div>
                                          </div>
                                          <div class="col-md-6">
                                            <div class="progress">
                                                <div class="progress-bar bg-warning" [style.width.%]="review.percentage">{{ review.percentage }}%</div>
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                                </ng-template>
                            </div>
                            <div class="col-md-6">
                                <ng-container *ngIf="loadingReview; else loadingReviewRef2">
                                    <ngx-skeleton-loader appearance="square"  [theme]="{ width: '100%', height: '280px' }"></ngx-skeleton-loader>
                                </ng-container>
                                <ng-template #loadingReviewRef2>
                                  <div class="row"  *ngFor="let review of reviews">
                                    <div class="col-md-4">
                                        <strong class='d-block'>{{ review.name }}</strong>
                                        <small class='small'>{{ review.createdAt | moment:'dddd, DD/MM/YYYY HH:mm' }}</small>
                                        <div class="text-warning">
                                            <i class="bi bi-star-fill"></i>
                                            <i class="bi bi-star-fill"></i>
                                            <i class="bi bi-star-fill"></i>
                                            <i class="bi bi-star"></i>
                                            <i class="bi bi-star"></i>
                                        </div>
                                    </div>
                                    <div class="col-md-8">
                                        <p>{{ review.reviewDescription }}</p>
                                    </div>
                                  </div>
                                </ng-template>
                            </div>
                            <div class="col-md-3">
                                <form [formGroup]="formData" (ngSubmit)="onSubmitReview()" novalidate>
                                    <input
                                      type="text"
                                      id="name"
                                      placeholder="Enter Your Name"
                                      class="form-control mb-2"
                                      [ngClass]="{ 'is-invalid': name?.invalid && name?.touched }"
                                      formControlName="name"
                                    />
                                    <div *ngIf="name?.invalid && name?.touched" class="invalid-feedback">
                                      <div *ngIf="name?.errors?.['required']">Name is required.</div>
                                    </div>
                                    <input
                                        type="email"
                                        id="email"
                                        placeholder="Your E-Mail Address"
                                        class="form-control mb-2"
                                        [ngClass]="{ 'is-invalid': email?.invalid && email?.touched }"
                                        formControlName="email"
                                      />
                                      <div *ngIf="email?.invalid && email?.touched" class="invalid-feedback">
                                        <div *ngIf="email?.errors?.['required']">Email is required.</div>
                                        <div *ngIf="email?.errors?.['email']">Email is not valid.</div>
                                      </div>
                                    <textarea
                                      class="form-control mb-2"
                                      placeholder="Your Review"
                                      [ngClass]="{ 'is-invalid': review?.invalid && review?.touched }"
                                      formControlName="review"
                                      rows="3"
                                      ></textarea>
                                      <div *ngIf="review?.invalid && review?.touched" class="invalid-feedback">
                                        <div *ngIf="review?.errors?.['required']">Review is required.</div>
                                      </div>
                                    <star-rating
                                      (starClickChange)="handleRating($event)"
                                      (ratingChange)="handleRating($event)"
                                      [starType]="'svg'"
                                      [rating]="rating">
                                    </star-rating>
                                    <button class="btn btn-primary text-white w-100 mt-3" [disabled]="formData.invalid">
                                        <i class="bi bi-telegram mb-1 me-1"></i> Submit
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <div class="section-title text-center">
                        <h3 class="title">Related Products</h3>
                    </div>
                    <div class="slider-container text-center">
                      <ng-container *ngIf="loadingCart; else loadingRelated">
                          <div class="row">
                            <div class="col-md-4">
                              <ngx-skeleton-loader appearance="square"  [theme]="{ width: '100%', height: '500px' }"></ngx-skeleton-loader>
                            </div>
                            <div class="col-md-4">
                              <ngx-skeleton-loader appearance="square"  [theme]="{ width: '100%', height: '500px' }"></ngx-skeleton-loader>
                            </div>
                            <div class="col-md-4">
                              <ngx-skeleton-loader appearance="square"  [theme]="{ width: '100%', height: '500px' }"></ngx-skeleton-loader>
                            </div>
                          </div>
                      </ng-container>
                      <ng-template #loadingRelated>
                          <app-related-product [products]="productRelated"> </app-related-product>
                      </ng-template>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
